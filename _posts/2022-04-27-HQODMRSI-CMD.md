---
title: "级联多级检测器的多分辨率遥感图像的高质量目标检测"
layout: post
tags: [images-fusion, remote-sensing]
cover: 2024-06-27-HQODMRSI-CMD/DSC05871.jpeg
cover_preview: 2024-06-27-HQODMRSI-CMD/DSC05871.jpeg
caption: 深圳观澜版画村
class: post-template
author: Shanxin Guo
toc:
  sidebar: left
giscus_comments: false
description: >
    基于深度学习的物体检测器在精度和自动化程度方面显著提升了遥感图像中的目标检测性能。然而，由于物体尺度的巨大变化，在多分辨率遥感图像中实现高质量检测仍然具有挑战性。检测质量通常由训练中使用的交并比（IoU）阈值定义。此外，多分辨率图像中正负样本的不平衡问题也会进一步降低检测精度。近期研究表明，基于级联的区域卷积神经网络（R-CNN）通过引入三级级联结构并逐步提高IoU阈值，可以实现更高的检测质量。然而，当增加到第四级时，级联R-CNN的性能却出现下降。我们通过研究发现，ROI特征与分类器之间的不匹配可能是导致性能下降的主要原因。
published: true
---


# 背景及科学问题

遥感图像中的目标检测在城市规划、地理信息系统更新和搜救行动等民用和军事应用中具有重要作用。与传统方法（如基于模板匹配或知识驱动的方法）相比，基于深度学习的方法通过将人工特征设计的负担转移到底层学习系统，能够从原始数据中自动提取特征，具有更强的特征表示能力，从而提取更高语义水平的特征图。凭借这一优势，基于深度学习的检测方法在计算机视觉和遥感领域均取得了显著成功。

与自然场景图像不同，遥感图像在不同的观测条件下具有更大的尺度变化和更多的特征复杂性，这就要求物体检测器具有更高的泛化能力。最近，基于DNN的检测方法从计算机视觉领域被引入到遥感领域，并在多类物体检测上取得了优异的成绩。遥感图像深度学习物体检测的许多基本问题得到了解决，如缺乏足够的训练样本、小物体检测的性能差，以及卫星图像中物体的旋转特性。撰写于2020年的全面回顾可以在文章中找到。

尽管如此，多分辨率遥感图像中物体尺度的巨大变化仍然给物体检测器带来巨大挑战。最近，一些研究从不同方面探讨了解决这一问题的可能性，可以归纳为三类。(1) 不同层次的特征融合：在这一类别中，许多融合模型都是为了提取多尺度的特征层次，以提高模型在小物体和大物体上的性能。有代表性的研究包括跨尺度特征融合（CSFF）、基于双特征金字塔网络（FPN）的偏振注意机制模块、特征融合架构（FFA）、多片特征金字塔网络和Quad-FPN。(2) 改进区域建议网络以生成更合适的锚点：这些模型解决了多尺度图像中锚点尺寸和物体尺寸的不匹配问题，如自适应长宽比锚点(SARA)，多尺度空间注意区域建议网络，以及尺寸折叠操作(SF)。(3) 建立平行网络来检测不同尺度的物体：其中一个代表性的工作是多专家检测网络（MEDNet）。

上述方法主要集中在不同尺度的物体之间的特征提取和特征匹配。除此之外，正负样本的不平衡也是模型无法检测不同尺度物体的另一个原因。与小物体相比，大物体更容易被识别为正样本，而且精度更高。当把由高分辨率图像预训练的模型应用于低分辨率图像时，大多数大物体会变成小物体，导致阳性样本太少，无法有效训练模型。

在基于锚点的检测器中，通常使用一个交叉-联合（IoU）阈值来区分阳性/阴性样本，这也定义了检测质量。选择一个合适的阈值是检测质量和精度之间的妥协，因为较低的IoU阈值会带来更多潜在的物体区域建议，但会有更多的噪声样本，这导致了不可靠的检测结果。然而，在训练中使用高的IoU阈值会导致阳性样本太少，从而导致模型过拟合。

为了达到高精度，IoU阈值必须与检测器假说的质量密切相关。级联R-CNN，作为两阶段基于锚的检测器的扩展，使用三阶段的级联结构来解决上述问题，训练样本的IoU（即假设的质量）可以通过级联的边界盒回归来逐步提高。这种级联结构依次提高阳性训练样本的数量和质量，以减少过拟合问题。在自然场景图像的实验中，级联结构在检测不同尺度的物体时取得了更好的精度。然而，在级联R-CNN的原始结构中，级联组件的最大数量为3个。当增加第四级时，整体检测性能就会下降。这就限制了级联检测器的扩展，以实现更好的检测性能。

在本文中，我们研究了增加更多级联阶段时性能下降的原因。我们发现，在推理时，级联R-CNN中的原始集合策略在分类器和兴趣区域（RoI）向量之间引入了不匹配，降低了分类精度。

为了克服这一局限性，我们提出了一种新的级联分类的集合策略，即采取同一阶段产生的RoI特征进行分类，而不是统一使用最后阶段的特征。最终的分类结果是通过整合所有阶段的分类器输出得到的。此外，边界盒回归的损失函数被修改以提高灵敏度，使级联回归器随着阶段数的增加而进一步收敛。修改后的级联结构在本文中被表示为级联R-CNN++。

本研究的主要贡献有以下几点。(1）我们研究了级联检测器在增加更多阶段时性能下降的原因；（2）我们提出了一种新的集合策略，以尽量减少推理时分类器和输入RoI之间的不匹配，并提高分类精度；（3）我们提出了一个修改的边界盒回归的损失函数，使边界盒回归在建立更多阶段时进一步收敛。所提出的Cascade R-CNN++方法可以在遥感数据集DOTA上实现最先进的检测性能。它可以在大多数需要基于区域建议的方法的情况下实施。在多分辨率遥感图像的实验中，所提出的方法在检测质量和精度上都优于级联R-CNN。

# 研究方法介绍：级联R-CNN++

级联R-CNN使用三级级联检测器来逐步改善训练样本的IoU分布。通过级联回归，可以实现更高的物体定位精度。然而，当增加第四级时，AP、AP50、AP60、AP70和AP80的指标都会下降，只有AP90略有增加。在此，我们研究了性能下降的原因。

在本文中，我们通过修改Cascade R-CNN来提出Cascade R-CNN++方法。首先，我们为分类器和推理时的RoI特征提出了一个新的集合策略。其次，我们提出了一个改进的损失函数，用于边界箱回归，以实现零附近的高灵敏度，这使得更多阶段的加入能够进一步收敛。图3显示了所提出的级联R-CNN++的一个五阶段的例子。区域建议的生成采用了RPN。

## 新的分类组合策略

正如在中所定义的，一个分类器被表示为一个函数h(xi)它将一个特征向量xi归入m+1个类中的一个，其中0为背景，其余每个值代表一个类。一个分类器的输出是一个m+1维向量，其最大值表示边界框中的物体所属的类别。分类器是通过最小化交叉熵损失Rcls来训练的。

## 边界盒回归的修正损失函数

在每个阶段，边界盒回归器被用来通过最小化真实边界盒和候选边界盒之间的偏移量来逐渐使候选提案接近真实标签位置。一个输入建议p可以通过以下方式转化为预测的真实标签框g。推导公式表示如下：

{% include figure.liquid path="/SIAT-GeoScience/assets/2022-04-27 公式.png" width="400px" class="z-depth-1 mx-auto d-block" caption="公式" %}

其中p=(px,py,pw,ph)表示输入建议的位置，g=(gx,gy,gw,gh)是预测的真实标签箱。Δ=(tx/cx,ty/cy,tw/cw,th/ch)代表距离向量，即由边界盒回归器进行的微小调整。是影响距离向量大小的权重，权重cx、cy、cw、ch最初设定为（10，10，5，5），并随着阶段的增加而逐渐增加。由于边界盒回归器对偏移向量Δ进行了微调，这些值通常是非常小的。因此，归一化被执行为Δ。对于一个图像补丁xj，级联R-CNN中使用的边界盒回归的损失函数可以表示为Rloc，其中Rloc是边界盒回归的交叉熵损失，j是一个候选方案的索引，Nloc是候选提案的数量，Lloc表示S1平滑L1函数。

其中f(xj,pj)是边界盒回归函数，pj=(pjx,pjy,pjw,pjh)是第j个是第j个候选方案，有四个坐标，即中心位置（pjx,pjy)，以及盒子的宽度和高度（pjw,pjy）。gj代表预测的真实标签框，以同样的方式指定（gj=(gjx,gjy,gjw,gjh)). 此后，除非需要，我们忽略上标j为简单起见。

为了使更多阶段的级联回归能够进一步收敛，我们改进了边界盒回归的损失函数，以实现零附近的高灵敏度。

其中sgn是符号函数，指数4/3的条款（tk/ck）4/3，和k∈{x,y,w,h}。是为了增加非线性并保持灵敏度和损失梯度之间的权衡。输入(tx,ty,tw,th)与边界箱输出偏移量（gx-px,gy-py,gw/pw,gh/ph）绘制成图。对于不同权重的原始和修改后的损失函数ci，i∈{x,y,w,h}。不同阶段。

{% include figure.liquid path="/SIAT-GeoScience/assets/2022-04-27 图4-图5.png" width="400px" class="z-depth-1 mx-auto d-block" caption="图4-图5" %}

{% include figure.liquid path="/SIAT-GeoScience/assets/2022-04-27 图6.png" width="400px" class="z-depth-1 mx-auto d-block" caption="图6" %}

图6展示了不同指数值对损失函数的影响。可以看出，较大的指数值在零附近具有更高的灵敏度，但收敛速度较慢。通过实验，我们选择了指数值为4/3，作为灵敏度和收敛速度之间的最佳平衡点。

# 试验结果

{% include figure.liquid path="/SIAT-GeoScience/assets/2022-04-27 表2-表5.png" width="400px" class="z-depth-1 mx-auto d-block" caption="表2-表5" %}

## 阶段性的比较

在DOTA数据集上，我们比较了三级、四级和五级级联R-CNN++的检测性能，它们都以ResNet-50为骨干。结果见表2，其中AP表示平均精度，AP50、AP75和AP90分别表示使用0.5、0.75和0.9的IoU阈值的检测精度。APS、APM和APL分别表示小型、中型和大型物体的检测精度。

如表2所示，整体检测精度随着阶段的增加而提高，以FPS（每秒帧数）衡量的推理速度没有明显下降。

## 建议修改的消融实验

通过使用ResNet-50骨干网进行消融实验，进一步分析了Cascade R-CNN++的检测性能。结果显示在表3中。采用新的集合策略和修改后的边界盒回归损失函数的级联检测器取得了最好的精度，在AP90中也有明显的改善。

## 与最先进的检测器的比较

在DOTA-v1.5数据集上，提议的Cascade R-CNN++的性能与最先进的两级/多级检测器进行了比较，详见表4。用*表示的条目使用了包括多尺度训练/推理和SoftNMS在内的增强措施。

如表4所示，与Faster R-CNN、FPN、RetinaNet和原始Cascade R-CNN相比，提议的Cascade R-CN++在所有指标上都取得了更高的精度。在AP90上的改进最为明显，其次是对中型和小型物体的检测精度（即APM和APS）。这些结果证明，所提出的方法是有效的，并且优于最先进的检测器，特别是在高质量检测方面。在实验中，我们还实现了具有多尺度训练/推理和softNMS的Cascade R-CNN++，在表4中用Cascade R-CNN++ *表示。通过这些改进，Cascade R-CNN++超过了Cascade R-CNN 4.6分。值得注意的是，最近的其他研究从不同的角度（如特征金字塔）探讨了改进措施，表明这些改进措施的累积效应可以进一步提高多阶段检测器在遥感物体检测、实例分割、关键点检测等领域的性能。

在另一个遥感数据集NWPU VHR-10上也进行了比较（表5）。训练以0.01的学习率开始，在30 k和40 k的迭代中分别降低到0.001和0.0001，并在50 k的迭代中完成。其他实施设置与DOTA-v1.5上的实验相同。

从表5中我们可以看出，所提出的Cascade R-CNN++在NWPU VHR-10数据集上产生了最好的性能，特别是在AP75和AP90所显示的高质量检测上。小物体的检测精度比原来的Cascade R-CNN方法提高了4.8%。

## 模型在多分辨率遥感图像上的可迁移性

进一步的分析是为了比较所提出的模型和原来的Cascade R-CNN在多分辨率遥感图像中的可迁移性。遥感数据集DOTA-v1.5中的图像按不同的系数（如2、3和4）进行了放大。由原始分辨率图像训练的探测模型直接用于推理，以模拟用有限的数据变异性训练的探测器被用于探测不同分辨率图像中的物体的大多数情况。如前所述，DOTA-v1.5数据集包含16类物体，如飞机、船舶、储罐、大型车辆、小型车辆等。这里我们以飞机和港口的检测为例。图7（单物体）和图8（多物体）显示了在多分辨率图像上实现的物体检测性能。

{% include figure.liquid path="/SIAT-GeoScience/assets/2022-04-27 图7" width="400px" class="z-depth-1 mx-auto d-block" caption="图7" %}

{% include figure.liquid path="/SIAT-GeoScience/assets/2022-04-27 图8" width="400px" class="z-depth-1 mx-auto d-block" caption="图8" %}

从图7和图8可以看出，Cascade R-CNN++在多分辨率图像中表现出更好的迁移能力，尤其是在小物体检测方面。随着图像分辨率的降低，Cascade R-CNN++的性能优势更加明显。

我们对DOTA-v1.5中所有测试图像上的16类物体进行了上述实验，使用了1、3/2、2、5/2、3、24/7和4的上标比例。图9显示了边界盒回归后获得的IU的博弈图。3/2的升尺度比率是指图像被升尺度2倍，降尺度3倍的情况。这与其他比率相同。

{% include figure.liquid path="/SIAT-GeoScience/assets/2022-04-27 图9" width="400px" class="z-depth-1 mx-auto d-block" caption="图9" %}

从图9中我们可以看出，对于按不同比例放大的遥感图像，Cascade R-CNN++比Cascade R-CNN获得了更高的IoU。随着放大比例的增加，Cascade R-CNN++获得的IoU分布的改善变得更加明显。这些结果表明，在多分辨率遥感图像中，Cascade R-CNN++比Cascade R-CNN获得了更高的检测质量。

# 结论

在本研究中，我们提出了Cascade R-CNN++，一种改进的级联结构，用于实现多分辨率遥感图像的高质量目标检测。通过引入新的分类组合策略和修改后的边界框回归损失函数，Cascade R-CNN++克服了原有级联R-CNN的扩展问题，并在高质量检测方面取得了显著提升。实验结果表明，Cascade R-CNN++在DOTA和NWPU VHR-10数据集上的检测精度和质量均优于现有方法，尤其是在高IoU阈值下的检测性能。

未来，我们计划探索级联结构在其他任务中的应用，例如实例分割和关键点检测，以进一步验证其通用性和有效性。


# 原文链接

[https://www.mdpi.com/2072-4292/14/9/2091](https://www.mdpi.com/2072-4292/14/9/2091)